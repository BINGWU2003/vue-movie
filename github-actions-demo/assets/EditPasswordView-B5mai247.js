import{J as V,I as d,H as k,r as u,o as y,c as x,f as a,w as o,e as I}from"./index-BtiZJA6V.js";import{a as b,E as D}from"./el-form-item-DnEKQG3Y.js";import{E as R}from"./el-button-BkswBdMW.js";import{E as T}from"./el-input-DQWJxFHl.js";import{e as U}from"./user-929Nb1Sz.js";import{E as m}from"./http-uaPK1vfr.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./event-NTjbwY5A.js";import"./index-D8AN6Cr_.js";import"./_baseClone-dr7Cctac.js";import"./_initCloneObject-C3mgaNU_.js";const B={class:"edit-password"},F={__name:"EditPasswordView",setup(S){const p=V(),{setAsideData:c,setRouterData:f,setAuthArr:_,setToken:v}=d(),{_id:w}=k(d()),t=u({pass:"",checkPass:""}),r=u(null),h=u({pass:[{validator:(l,e,s)=>{if(e==="")s(new Error("请输入密码"));else if(e.length>=8&&e.length<=14){if(t.value.checkPass!==""){if(!r.value)return;r.value.validateField("checkPass",()=>null)}s()}else s(new Error("密码长度应为8~14字符之间"))},trigger:"blur"}],checkPass:[{validator:(l,e,s)=>{e===""?s(new Error("请再输入一遍密码")):e!==t.value.pass?s(new Error("两次输入的密码不匹配!")):s()},trigger:"blur"}]}),E=()=>{r.value.validate().then(async()=>{await U({_id:w.value,userData:{userPassword:t.value.pass}}).then(l=>{m({type:"success",message:l.data.msg});let e=3;const s=setInterval(()=>{e===1&&clearInterval(s),m({type:"warning",message:`${e}s后自动退出登陆`}),e--},1e3);setTimeout(()=>{v(""),c([]),f([]),_([]),p.push("/login")},3e3)})}).catch(()=>{console.log("error")})};return(l,e)=>{const s=T,n=b,g=R,P=D;return y(),x("div",B,[a(P,{ref_key:"formRef",ref:r,model:t.value,"status-icon":"",rules:h.value,"label-width":"120px",class:"demo-formData"},{default:o(()=>[a(n,{label:"输入新密码",prop:"pass"},{default:o(()=>[a(s,{modelValue:t.value.pass,"onUpdate:modelValue":e[0]||(e[0]=i=>t.value.pass=i),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(n,{label:"再输入一遍密码",prop:"checkPass"},{default:o(()=>[a(s,{modelValue:t.value.checkPass,"onUpdate:modelValue":e[1]||(e[1]=i=>t.value.checkPass=i),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(n,null,{default:o(()=>[a(g,{type:"primary",onClick:E},{default:o(()=>[I("提交")]),_:1})]),_:1})]),_:1},8,["model","rules"])])}}},Q=A(F,[["__scopeId","data-v-aab2d9b5"]]);export{Q as default};
